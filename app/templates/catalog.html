{% extends "base.html" %}
{% block content %}

<section class="mb-10 space-y-4 rounded-[32px] border border-white/70 bg-white/80 p-8 shadow-card/20 backdrop-blur" data-anim>
  <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
    <div class="space-y-2">
      <span class="inline-flex items-center rounded-full bg-brand-50 px-4 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-brand-500">
        Catalog
      </span>
      <h1 class="font-heading text-3xl text-brand-900 sm:text-4xl">Durable medical equipment directory</h1>
      <p class="max-w-2xl text-brand-500">
        Find compliant equipment by HCPCS code, clinical pathway, or patient need. Filters highlight coverage and documentation nuances before you add to cart.
      </p>
    </div>
    <div class="rounded-3xl border border-brand-100 bg-white/90 px-5 py-4 shadow-sm">
      <p class="text-xs uppercase tracking-[0.25em] text-brand-300">Live inventory snapshot</p>
      <p class="mt-1 text-sm text-brand-600">Products available: <span class="font-semibold text-brand-700">{{ products|length }}</span></p>
    </div>
  </div>
</section>

<div class="grid grid-cols-12 gap-6" data-anim>
  <aside class="col-span-12 space-y-6 rounded-[28px] border border-white/70 bg-white/80 p-6 shadow-card/20 backdrop-blur md:col-span-4 lg:col-span-3">
    <div class="flex items-center justify-between">
      <p class="font-heading text-brand-800">Refine results</p>
      <a href="/catalog" class="text-xs font-semibold uppercase tracking-[0.2em] text-brand-300 hover:text-brand-500">Reset</a>
    </div>
    <form action="/catalog" method="get" class="space-y-6">
      <div class="space-y-2">
        <label for="catalog-search" class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-400">
          Search
        </label>
        <div class="flex items-center gap-2 rounded-2xl border border-brand-100 bg-white/90 px-3 py-2 shadow-sm">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-brand-50 text-brand-500">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <circle cx="11" cy="11" r="6"/>
              <path d="M20 20l-3.5-3.5" stroke-linecap="round"/>
            </svg>
          </span>
          <input id="catalog-search" type="text" name="q" value="{{ q }}" placeholder="e.g., E0260 or 'wheelchair'" class="w-full border-none bg-transparent text-sm text-brand-700 placeholder:text-brand-300 focus:outline-none focus:ring-0">
        </div>
      </div>

      <div class="space-y-3">
        <p class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-400">Type</p>
        <div class="space-y-2">
          {% set types = ["Oxygen Therapy","Nebulizer & Respiratory Equipment","Hospital Beds & Patient Care","Mobility & Walking Aids","Pressure Relief Systems","Orthotics & Supports","Home Care Accessories"] %}
          {% for t in types %}
          <label class="flex items-center gap-3 rounded-2xl border border-brand-50 bg-white/70 px-3 py-2 text-sm text-brand-600 hover:border-brand-200">
            <input type="checkbox" name="type" value="{{ t }}" class="rounded border-brand-200 text-brand-500 focus:ring-brand-400">
            <span>{{ t }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="space-y-3">
        <p class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-400">Coverage</p>
        <div class="flex flex-wrap gap-2">
          {% for cov in ["Medicare","Medicaid","Private","Self-Pay"] %}
          <label class="inline-flex items-center gap-2 rounded-full border border-brand-100 bg-white/80 px-3 py-1.5 text-xs font-medium text-brand-600 hover:border-brand-200">
            <input type="checkbox" name="coverage" value="{{ cov }}" class="h-4 w-4 rounded border-brand-200 text-brand-500 focus:ring-brand-400">
            <span>{{ cov }}</span>
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="space-y-3">
        <p class="text-xs font-semibold uppercase tracking-[0.25em] text-brand-400">Documentation</p>
        <div class="space-y-2">
          {% for d in ["DWO","Face-to-Face","Prior Auth"] %}
          <label class="flex items-center justify-between rounded-2xl border border-brand-50 bg-white/70 px-4 py-3 text-sm text-brand-600 hover:border-brand-200">
            <span>{{ d }}</span>
            <input type="checkbox" name="doc" value="{{ d }}" class="h-4 w-4 rounded border-brand-200 text-brand-500 focus:ring-brand-400">
          </label>
          {% endfor %}
        </div>
      </div>

      <button class="w-full rounded-full bg-brand-600 px-4 py-3 text-sm font-semibold text-white shadow-card transition hover:-translate-y-0.5 hover:bg-brand-500">
        Apply filters
      </button>
    </form>
  </aside>

  <main class="col-span-12 space-y-8 md:col-span-8 lg:col-span-9">
    <form action="/catalog" class="flex flex-col gap-3 rounded-[28px] border border-white/70 bg-white/80 p-5 shadow-card/20 backdrop-blur sm:flex-row sm:items-center sm:gap-4">
      <div class="flex w-full items-center gap-2 rounded-2xl border border-brand-100 bg-white/90 px-3 py-2 shadow-sm">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-brand-50 text-brand-500">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <circle cx="11" cy="11" r="6"/>
            <path d="M20 20l-3.5-3.5" stroke-linecap="round"/>
          </svg>
        </span>
        <input name="q" value="{{ q }}" placeholder="Search by product name or HCPCS (e.g., E0260)â€¦"
               class="w-full border-none bg-transparent text-sm text-brand-700 placeholder:text-brand-300 focus:outline-none focus:ring-0 md:text-base">
      </div>
      <button class="inline-flex shrink-0 items-center justify-center rounded-full bg-brand-600 px-6 py-2.5 text-sm font-semibold text-white shadow-card transition hover:-translate-y-0.5 hover:bg-brand-500">
        Search
      </button>
    </form>

    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 xl:grid-cols-3">
      {% for p in products %}
      <a href="/products/{{ p.id }}" class="group flex flex-col overflow-hidden rounded-[28px] border border-white/70 bg-white/85 shadow-card/30 backdrop-blur transition hover:-translate-y-1 hover:shadow-card">
        <div class="relative aspect-square overflow-hidden">
          {% if p.image_url %}
          <img src="{{ p.image_url }}" alt="{{ p.name }}" class="h-full w-full object-cover transition duration-500 group-hover:scale-105">
          {% else %}
          <div class="flex h-full w-full items-center justify-center bg-gradient-to-br from-brand-200 via-brand-500 to-dusk-500 text-3xl font-semibold text-white">
            {{ p.name.split(' ')[0]|capitalize }}
          </div>
          {% endif %}
          {% if p.hcpcs_code %}
          <span class="absolute left-3 top-3 rounded-full bg-white/90 px-3 py-1 text-xs font-semibold text-brand-600 shadow-sm ring-1 ring-brand-100">
            HCPCS {{ p.hcpcs_code }}
          </span>
          {% endif %}
        </div>
        <div class="flex flex-1 flex-col gap-4 p-6">
          <div>
            <h2 class="font-heading text-lg text-brand-900 transition group-hover:text-brand-600">{{ p.name }}</h2>
            <p class="mt-1 text-xs uppercase tracking-[0.25em] text-brand-300">SKU {{ p.sku }}</p>
          </div>
          <p class="text-sm leading-relaxed text-brand-500">
            {{ p.description or "Clinically vetted equipment with flexible coverage options." }}
          </p>
          <div class="flex flex-wrap gap-2 text-xs font-medium text-brand-600">
            <span class="inline-flex items-center gap-1 rounded-full bg-brand-50 px-3 py-1">
              <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
              </svg>
              Medicare
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-brand-50 px-3 py-1">
              <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
              </svg>
              Private
            </span>
          </div>
          <div class="mt-auto flex items-center justify-between border-t border-brand-50 pt-4">
            <span class="text-lg font-semibold text-brand-800">${{ '%.2f' | format(p.price_cents/100) }}</span>
            <span class="inline-flex items-center gap-2 text-sm font-semibold text-brand-600">
              View details
              <svg class="h-4 w-4 transition group-hover:translate-x-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M13 6l6 6-6 6"/>
              </svg>
            </span>
          </div>
        </div>
      </a>
      {% endfor %}
      {% if not products %}
      <div class="rounded-3xl border border-white/70 bg-white/70 p-8 text-center text-brand-500">
        No products found. Adjust filters or try a different HCPCS code.
      </div>
      {% endif %}
    </div>
  </main>
</div>

{% endblock %}
